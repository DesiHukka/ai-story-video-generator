require("dotenv").config();
const textToSpeech = require("@google-cloud/text-to-speech");
const fs = require("fs");
const util = require("util");
const path = require("path");
const client = new textToSpeech.TextToSpeechClient({
  keyFilename: process.env.GOOGLE_APPLICATION_CREDENTIALS,
});

async function synthesizeSpeech(scene, outputFile) {
  console.log(
    `ЁЯФК [TTS] Generating speech for scene ${
      scene.scene_number
    } тЖТ ${path.basename(outputFile)}`
  );
  const request = {
    input: { text: scene.narration },
    voice: {
      languageCode: "hi-IN",
      name: "hi-IN-Chirp3-HD-Charon", // You can change voice here
      ssmlGender: "FEMALE",
    },
    audioConfig: {
      audioEncoding: "MP3",
      speakingRate: 1,
      pitch: 0,
    },
  };

  const [response] = await client.synthesizeSpeech(request);
  const writeFile = util.promisify(fs.writeFile);
  await writeFile(outputFile, response.audioContent, "binary");
  console.log(`тЬЕ Audio saved as ${outputFile}`);
}
// // Test with custom text
// synthesizeSpeech(
//   `рдПрдХ рдмрд╛рд░ рдХреА рдмрд╛рдд рд╣реИ, рдПрдХ рдЫреЛрдЯреЗ рд╕реЗ рдЧрд╛рдБрд╡ рдореЗрдВ рд░рд╛рд╣реБрд▓ рдирд╛рдо рдХрд╛ рдПрдХ рд▓рдбрд╝рдХрд╛ рд░рд╣рддрд╛ рдерд╛ред рдЙрд╕реЗ рдмрд╛рд░рд┐рд╢ рдмрд╣реБрдд рдкрд╕рдВрдж рдереАред рдЬреИрд╕реЗ рд╣реА рдЖрд╕рдорд╛рди рдореЗрдВ рдХрд╛рд▓реЗ рдмрд╛рджрд▓ рдЫрд╛рддреЗ, рд╡реЛ рднрд╛рдЧрддрд╛ рд╣реБрдЖ рдмрд╛рд╣рд░ рдирд┐рдХрд▓ рдЬрд╛рддрд╛ рдФрд░ рдХрд╛рдЧрдЬрд╝ рдХреА рдирд╛рд╡реЗрдВ рдмрдирд╛рдХрд░ рдЙрдиреНрд╣реЗрдВ рдкрд╛рдиреА рдореЗрдВ рдЫреЛрдбрд╝ рджреЗрддрд╛ред

// рдПрдХ рджрд┐рди, рдЬрдм рдмрд╣реБрдд рдЬрд╝реЛрд░ рдХреА рдмрд╛рд░рд┐рд╢ рд╣реЛ рд░рд╣реА рдереА, рд░рд╛рд╣реБрд▓ рдиреЗ рдЕрдкрдиреА рд╕рдмрд╕реЗ рд╕реБрдВрджрд░ рдирд╛рд╡ рдмрдирд╛рдИ рдФрд░ рдЙрд╕реЗ рдмрд╣рддреЗ рдкрд╛рдиреА рдореЗрдВ рдЫреЛрдбрд╝ рджрд┐рдпрд╛ред рд▓реЗрдХрд┐рди рдЕрдЪрд╛рдирдХ рддреЗрдЬрд╝ рд╣рд╡рд╛ рдЪрд▓реА рдФрд░ рдирд╛рд╡ рдПрдХ рдмрдбрд╝реЗ рдЧрдбреНрдвреЗ рдореЗрдВ рдЬрд╛рдХрд░ рдлрдБрд╕ рдЧрдИред

// рд░рд╛рд╣реБрд▓ рдЙрджрд╛рд╕ рд╣реЛ рдЧрдпрд╛ред рддрднреА рд╡рд╣рд╛рдБ рдПрдХ рдмреБрдЬрд╝реБрд░реНрдЧ рджрд╛рджреА рдЖрдИрдВ, рдЬрд┐рдирдХреЗ рдкрд╛рд╕ рдПрдХ рдЫреЛрдЯреА рд╕реА рдЫрдбрд╝реА рдереАред рдЙрдиреНрд╣реЛрдВрдиреЗ рдореБрд╕реНрдХреБрд░рд╛ рдХрд░ рдХрд╣рд╛, тАЬрдХрднреА-рдХрднреА рд╣рдорд╛рд░реА рдкрд╕рдВрджреАрджрд╛ рдЪреАрдЬрд╝реЗрдВ рднреА рдореБрд╢реНрдХрд┐рд▓реЛрдВ рдореЗрдВ рдкрдбрд╝ рдЬрд╛рддреА рд╣реИрдВред рд▓реЗрдХрд┐рди рдЕрдЧрд░ рд╣рдо рдХреЛрд╢рд┐рд╢ рдХрд░реЗрдВ, рддреЛ рдЙрдиреНрд╣реЗрдВ рд╡рд╛рдкрд╕ рдкрд╛ рд╕рдХрддреЗ рд╣реИрдВредтАЭ

// рджрд╛рджреА рдиреЗ рдЕрдкрдиреА рдЫрдбрд╝реА рд╕реЗ рдирд╛рд╡ рдХреЛ рдзреАрд░реЗ-рдзреАрд░реЗ рдмрд╛рд╣рд░ рдирд┐рдХрд╛рд▓рд╛ рдФрд░ рд░рд╛рд╣реБрд▓ рдХреЛ рд╡рд╛рдкрд╕ рджреЗ рджреАред рд░рд╛рд╣реБрд▓ рдХреА рдЖрдБрдЦреЗрдВ рдЪрдордХ рдЙрдареАрдВред

// рдЙрд╕ рджрд┐рди рдХреЗ рдмрд╛рдж, рд░рд╛рд╣реБрд▓ рдиреЗ рд╕рд┐рд░реНрдл рдирд╛рд╡реЗрдВ рдирд╣реАрдВ рдмрдирд╛рдИ тАФ рдЙрд╕рдиреЗ рд╕реАрдЦрд╛ рдХрд┐ рд╣рд░ рдкрд░реЗрд╢рд╛рдиреА рдХрд╛ рд╣рд▓ рдзреИрд░реНрдп рдФрд░ рдорджрдж рд╕реЗ рдирд┐рдХрд▓ рд╕рдХрддрд╛ рд╣реИред
// `,
//   "output2_large.mp3"
// );
module.exports = { synthesizeSpeech };
